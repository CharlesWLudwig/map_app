{% extends "base.html" %}

{% block content %}
<script>
    let id;
    let target;
    let options;

    function success(pos) {
    const crd = pos.coords;

    if (target.latitude === crd.latitude && target.longitude === crd.longitude) {
        console.log("Congratulations, you reached the target");
        navigator.geolocation.clearWatch(id);
    }
    }

    function error(err) {
    console.error(`ERROR(${err.code}): ${err.message}`);
    }

    target = {
    latitude: 0,
    longitude: 0,
    };

    options = {
    enableHighAccuracy: false,
    timeout: 5000,
    maximumAge: 0,
    };

    const watchID = navigator.geolocation.watchPosition((position) => {
        console.log(position.coords.latitude, position.coords.longitude);

        document.getElementById("user_latitude").value = position.coords.latitude;

        document.getElementById("user_longitude").value = position.coords.longitude;

        document.getElementById("target_latitude").value = target.latitude;

        document.getElementById("target_longitude").value = target.longitude;
    });
</script>  

<div style="display: flex; justify-content: space-between;">
    <form action="{{ url_for("profile_post")}}" method="post" id="latlongform">
        <label for="user_latitude">Latitude:</label>
        <input type="text" 
        id="user_latitude" 
        name="browser_latitude" 
        placeholder="Please wait..." 
        required
        value="{{ user_latitude }}">

        <label for="user_longitude">Longitude:
        </label>
        <input type="text" 
        id="user_longitude" 
        name="browser_longitude" 
        placeholder="Please wait..." 
        required 
        value="{{ user_longitude }}">        
        <button type="submit" id="submit">Share Your Current Location</button>
    </form>
    <br>
</div>

<div style="width: 100vw; display: block">
    <div style="float: left; left: 0; width: 50%;">
        {% if df %}
            {{ df.to_html() | safe }}
        {% endif %}    
        <br>
        {% if reply %}
        <div class="cards">
            {% for key, value in reply.items() %}
                <div class="card">{{ key }}: {{ value}}</div>
            {% endfor %}
        {% endif %}
        {% if current_weather %}
            {% for key, value in current_weather.items() %}
                <div class="card">{{ key }}: {{ value}}</div>
            {% endfor %}
        {% endif %}
        <br>
        </div>        
        <!--
        {% if geojson_data %}
            {{ geojson_data }}
        {% endif %}
        <br>
            {% if json_result %}
                {{ json_result }}
            {% endif %}
        -->
        <!-- {{ forecast_weather }} -->
        </div>
    <div style="float: right; right: 0; width: 50%">
        {% if map %}
        <div class="cards">
            <div class="card" style="width: 50vw; height: 500px">{{ map._repr_html_() | safe }}
            </div>
        </div>
        {% endif %}
    </div>
</div>
<!---->
<div style="width: 100%; display: flex; justify-content: space-between; bottom: 0;">
    <div style="width: 20%; height: 200px; border: 1px solid black; background-color: whitesmoke;" id="todo">
    </div>
    <div style="width: 20%; height: 200px; border: 1px solid black; background-color: whitesmoke;" id="todo">
    </div>
    <div style="width: 20%; height: 200px; border: 1px solid black; background-color: whitesmoke;" id="todo">
    </div>
    <div style="width: 20%; height: 200px; border: 1px solid black; background-color: whitesmoke;" id="todo">
    </div>
    <div style="width: 20%; height: 200px; border: 1px solid black; background-color: whitesmoke;" id="todo">
    </div>
</div>
{% endblock %}