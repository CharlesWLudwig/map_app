{% extends "base.html" %}

{% block content %}
<script>
    let id;
    let target;
    let options;

    function success(pos) {
    const crd = pos.coords;

    if (target.latitude === crd.latitude && target.longitude === crd.longitude) {
        console.log("Congratulations, you reached the target");
        navigator.geolocation.clearWatch(id);
    }
    }

    function error(err) {
    console.error(`ERROR(${err.code}): ${err.message}`);
    }

    target = {
    latitude: 0,
    longitude: 0,
    };

    options = {
    enableHighAccuracy: false,
    timeout: 5000,
    maximumAge: 0,
    };

    const watchID = navigator.geolocation.watchPosition((position) => {
        console.log(position.coords.latitude, position.coords.longitude);

        document.getElementById("user_latitude").value = position.coords.latitude;

        document.getElementById("user_longitude").value = position.coords.longitude;

        document.getElementById("target_latitude").value = target.latitude;

        document.getElementById("target_longitude").value = target.longitude;
    });
</script> 

<div style="display: flex; justify-content: space-between;">
    <form action="{{ url_for("profile_post")}}" method="post" id="latlongform">
        <label for="user_latitude">Latitude:</label>
        <input type="text" 
        id="user_latitude" 
        name="browser_latitude" 
        placeholder="Please wait..." 
        required
        value="{{ user_latitude }}">

        <label for="user_longitude">Longitude:
        </label>
        <input type="text" 
        id="user_longitude" 
        name="browser_longitude" 
        placeholder="Please wait..." 
        required 
        value="{{ user_longitude }}">        
        <button type="submit" id="submit">Share Your Current Location</button>
    </form>
    <br>
</div>

<div style="width: 100vw; display: block">
    <div style="float: left; left: 0; width: 50%;">
        {% if df %}
            {{ df.to_html() | safe }}
        {% endif %}    
        <br>
        {% if reply %}
        <div class="cards">
            {% for key, value in reply.items() %}
                <div class="card">
                        <p><i>{{ key }}</i></p>
                        <h3><em>{{ value }}</em></h3>
                </div>
            {% endfor %}
        {% endif %}
        {% if current_weather %}
            {% for key, value in current_weather.items() %}
                <div class="card">
                    <p><i>{{ key }}</i></p>
                    <h3><em>{{ value }}</em></h3>
                </div>
            {% endfor %}
        {% endif %}
        <br>
        </div>      
        <!-- {{ forecast_weather }} -->
        </div>
    <div style="float: right; width: 50%">
       {% if map %}
        <div class="cards">
            <div class="card" style="float: right; right: 10px; width: 40vw; height: 500px">
                {{ map._repr_html_() | safe }}
            </div>
        </div>
        {% endif %}
    </div>
</div>
<!--
{% if forecast_dict %}
{% for key, value in forecast_dict.items() %}
        <img src="{{ value['name']['icon'] }}" alt="{{value['name']}}_pic" />
{% endfor %}
{% endif %}
-->

{% if day_dict %}
<div class="forecast_tab">
    <button class="tablinks" onclick="openForecastTab(event, 'Day')" id="defaultTab">Day</button>
    <button class="tablinks" onclick="openForecastTab(event, 'Night')">Night</button>
</div>

  <div id="Day" class="forecast_tabcontent">
    <span onclick="this.parentElement.style.display='none'" class="closeTab">&times</span>
    <h3>DayTime</h3>
        {{ day_dict['shortForecast']}}    
        {{ day_dict['detailedForecast']}}

    <div style="width: 100%; display: flex; flex: wrap; justify-content: space-evenly;">
        {% for key, value in day_dict.items() %}
        <div style="width: 10%; height: 200px; border: 1px solid black; background-color: whitesmoke;" id="todo">       
            <div class="imgContainer">
                <img style="opacity: 50%" src="{{value['icon']}}" alt="weather_pic" />
                {{ value['name'] }}
                <br>
                {{ value['temperature'] }} {{ value['temperatureUnit'] }} - {{ value['temperatureTrend'] }}
                <br>
                {{ value['windSpeed'] }} {{ value['windDirection'] }}
                <br>
                {{ value['probabilityOfPrecipitation']['value'] }} {{ value['probabilityOfPrecipitation']['unitCode'][1] }}
                <br>
                {{ value['relativeHumidity']['value'] }} {{ value['relativeHumidity']['unitCode'][1] }} 
            </div> 
            </div>
        {% endfor %}
        </div>
  </div>
{% endif %}

{% if night_dict %}
<div id="Night" class="forecast_tabcontent">
    <span onclick="this.parentElement.style.display='none'" class="closeTab">&times</span>
    <h3>NightTime</h3>
        {{ night_dict['shortForecast']}}    
        {{ night_dict['detailedForecast']}}

    <div style="width: 100%; display: flex; flex: wrap; justify-content: space-evenly;">
        {% for key, value in night_dict.items() %}
        <div style="width: 10%; height: 200px; border: 1px solid black; background-color: whitesmoke;" id="todo">       
            <div class="imgContainer">
                <img style="opacity: 50%" src="{{value['icon']}}" alt="weather_pic" />
                {{ value['name'] }}
                <br>
                {{ value['temperature'] }} {{ value['temperatureUnit'] }} - {{ value['temperatureTrend'] }}
                <br>
                {{ value['windSpeed'] }} {{ value['windDirection'] }}
                <br>
                {{ value['probabilityOfPrecipitation']['value'] }} {{ value['probabilityOfPrecipitation']['unitCode'][1] }}
                <br>
                {{ value['relativeHumidity']['value'] }} {{ value['relativeHumidity']['unitCode'][1] }} 
            </div> 
            </div>
        {% endfor %}
        </div>
  </div>
{% endif %}

<script>
    function openForecastTab(e, forecastTime) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("forecast_tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(forecastTime).style.display = "block";
      e.currentTarget.className += " active";
    }
    
    document.getElementById("defaultTab").click();
    </script>
{% endblock %}